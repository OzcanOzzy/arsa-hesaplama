<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emlaknomi Arsa Hesaplama</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel CDN (Tarayıcıda JSX okuyabilmek için) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- HTML2PDF CDN (Doğrudan PDF İndirmek İçin) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            @page { margin: 1cm; }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        
        .blueprint-bg {
            background-color: #0f172a;
            background-image: linear-gradient(#1e293b 1px, transparent 1px), linear-gradient(90deg, #1e293b 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .stairs-pattern {
            background-image: repeating-linear-gradient(0deg, transparent, transparent 4px, #cbd5e1 4px, #cbd5e1 6px);
        }

        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            transform: rotate(180deg);
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- İKON BİLEŞENLER ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Building2 = ({className}) => <Icon className={className}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></Icon>;
        const MapPin = ({className}) => <Icon className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
        const Share2 = ({className}) => <Icon className={className}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/></Icon>;
        const FileText = ({className}) => <Icon className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></Icon>;
        const Ruler = ({className}) => <Icon className={className}><path d="M21.3 15.3l-5.6 5.6a2.83 2.83 0 0 1-4 0l-9.9-9.9a2.83 2.83 0 0 1 0-4l5.6-5.6a2.83 2.83 0 0 1 4 0l9.9 9.9a2.83 2.83 0 0 1 0 4Z"/><path d="M14.5 4.5l5 5"/><path d="M12.5 6.5l2 2"/><path d="M10.5 8.5l2 2"/><path d="M8.5 10.5l2 2"/><path d="M6.5 12.5l2 2"/></Icon>;
        const ChevronDown = ({className}) => <Icon className={className}><path d="m6 9 6 6 6-6"/></Icon>;
        const LayoutGrid = ({className}) => <Icon className={className}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></Icon>;
        const Home = ({className}) => <Icon className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>;
        const AlertTriangle = ({className}) => <Icon className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>;
        const Minus = ({className}) => <Icon className={className}><path d="M5 12h14"/></Icon>;
        const Plus = ({className}) => <Icon className={className}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Trash2 = ({className}) => <Icon className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const PieChart = ({className}) => <Icon className={className}><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></Icon>;
        const MapIcon = ({className}) => <Icon className={className}><polygon points="3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21"/><line x1="9" x2="9" y1="3" y2="18"/><line x1="15" x2="15" y1="6" y2="21"/></Icon>;
        const CheckCircle = ({className}) => <Icon className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></Icon>;
        const Settings2 = ({className}) => <Icon className={className}><path d="M20 7h-9"/><path d="M14 17H5"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></Icon>;
        const Info = ({className}) => <Icon className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const PenTool = ({className}) => <Icon className={className}><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></Icon>;
        const X = ({className}) => <Icon className={className}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></Icon>;
        const Layout = ({className}) => <Icon className={className}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></Icon>;

        // --- UYGULAMA MANTIK KODLARI ---
        const calcBrut = (net, multiplier = 1.30) => Math.round(net * multiplier);

        const DAİRE_STANDARTLARI = {
            '1+1': { Kucuk: { net: 35, brut: calcBrut(35) }, Orta: { net: 45, brut: calcBrut(45) }, Buyuk: { net: 55, brut: calcBrut(55) } },
            '2+1': { Kucuk: { net: 70, brut: calcBrut(70) }, Orta: { net: 80, brut: calcBrut(80) }, Buyuk: { net: 100, brut: calcBrut(100) } },
            '3+1': { Kucuk: { net: 95, brut: calcBrut(95) }, Orta: { net: 120, brut: calcBrut(120) }, Buyuk: { net: 140, brut: calcBrut(140) } },
            '4+1': { Kucuk: { net: 130, brut: calcBrut(130) }, Orta: { net: 160, brut: calcBrut(160) }, Buyuk: { net: 180, brut: calcBrut(180) } }
        };

        const checkKapasite = (testSepet, ozetBilgileri) => {
            if (!ozetBilgileri.katSayisi || ozetBilgileri.katSayisi <= 0) return true;
            let items = [];
            Object.values(testSepet).forEach(d => { for(let i=0; i<d.adet; i++) items.push(d.brut); });
            if (items.length === 0) return true;
            items.sort((a, b) => b - a);
            let floors = [];
            if (ozetBilgileri.zeminBrutKapasite > 0) floors.push(ozetBilgileri.zeminBrutKapasite);
            for (let i = 0; i < ozetBilgileri.normalKatAdeti; i++) floors.push(ozetBilgileri.normalKatBrutKapasite);
            if (ozetBilgileri.hasBucukKat && ozetBilgileri.bucukKatBrutKapasite > 0) floors.push(ozetBilgileri.bucukKatBrutKapasite);
            
            for (let brut of items) {
                let placed = false;
                for (let i = 0; i < floors.length; i++) {
                    if (floors[i] + 0.01 >= brut) {
                        floors[i] -= brut; placed = true; break;
                    }
                }
                if (!placed) return false; 
            }
            return true;
        };

        const getElasticScenarios = (oda, oz) => {
            if (!oz.katSayisi || oz.katSayisi <= 0) return [];
            const results = [];
            const types = ['Buyuk', 'Orta', 'Kucuk'];
            const typeLabels = { 'Buyuk': 'Büyük', 'Orta': 'Orta', 'Kucuk': 'Küçük' };

            const calcElasticFit = (cap, stdBrut) => {
                if (cap <= 0) return { count: 0, actualBrut: 0, waste: 0 };
                const maxBrut = stdBrut * 1.10; 
                const minBrut = stdBrut * 0.90; 
                const maxCount = Math.floor(cap / minBrut);
                if (maxCount === 0) return { count: 0, actualBrut: 0, waste: cap };
                const idealBrut = cap / maxCount;
                if (idealBrut <= maxBrut) return { count: maxCount, actualBrut: idealBrut, waste: 0 };
                else return { count: maxCount, actualBrut: maxBrut, waste: cap - (maxCount * maxBrut) };
            };

            types.forEach(t => {
                const stdBrut = DAİRE_STANDARTLARI[oda][t].brut;
                const zeminRes = calcElasticFit(oz.zeminBrutKapasite, stdBrut);
                const normalRes = calcElasticFit(oz.normalKatBrutKapasite, stdBrut);
                const bucukRes = oz.hasBucukKat ? calcElasticFit(oz.bucukKatBrutKapasite, stdBrut) : { count: 0, actualBrut: 0, waste: 0 };
                const totalAdet = zeminRes.count + (normalRes.count * oz.normalKatAdeti) + bucukRes.count;
                
                if (totalAdet > 0) {
                    const normalNet = normalRes.count > 0 ? (normalRes.actualBrut / oz.brutMultiplier) : 0;
                    const changePercent = normalRes.count > 0 ? ((normalRes.actualBrut - stdBrut) / stdBrut) * 100 : 0;
                    results.push({
                        type: `${typeLabels[t]} Tek Tip (Esnek)`, odaTipi: oda, totalAdet: totalAdet,
                        normalCount: normalRes.count, normalNet: normalNet, normalBrut: normalRes.actualBrut,
                        changePercent: changePercent, hasNormal: oz.normalKatAdeti > 0
                    });
                }
            });
            return results;
        };

        // --- ARSA SİMÜLASYONU (GÖRSEL ALAN) ---
        const PlotSimulation = ({ edges, setbacks, arsaAlani }) => {
            const validEdges = edges.filter(e => parseFloat(e.length) > 0).map(e => ({...e, val: parseFloat(e.length)}));
            if (validEdges.length < 3) {
                return (
                    <div className="w-full mt-4 p-6 border-2 border-dashed border-slate-200 rounded-2xl bg-slate-50 flex items-center justify-center text-center">
                        <p className="text-xs font-bold text-slate-400">Çizim için en az 3 geçerli kenar uzunluğu girin.</p>
                    </div>
                );
            }

            const totalLength = validEdges.reduce((sum, e) => sum + e.val, 0);
            const maxEdge = Math.max(...validEdges.map(e => e.val));

            if (maxEdge >= totalLength - maxEdge) {
                return (
                    <div className="w-full mt-4 p-4 border border-red-200 bg-red-50 rounded-2xl flex items-center gap-3">
                        <AlertTriangle className="w-6 h-6 text-red-500 shrink-0" />
                        <p className="text-xs font-bold text-red-800">Girilen kenar ölçüleri kapalı bir arsa şekli oluşturamaz.</p>
                    </div>
                );
            }

            const size = 300;
            const center = size / 2;
            const radius = 100; 
            
            const arsa = parseFloat(arsaAlani) || (Math.pow(totalLength / (2 * Math.PI), 2) * Math.PI);
            const pxPerMeter = radius / Math.sqrt(arsa / Math.PI);

            const N = validEdges.length;
            const outerPoints = [];
            
            let currentAngle = 0;
            validEdges.forEach((edge) => {
                const angleSpan = (edge.val / totalLength) * 2 * Math.PI;
                outerPoints.push({ x: center + radius * Math.cos(currentAngle), y: center + radius * Math.sin(currentAngle) });
                currentAngle += angleSpan;
            });

            const offsetLines = [];
            for (let i = 0; i < N; i++) {
                const p1 = outerPoints[i], p2 = outerPoints[(i + 1) % N];
                const dx = p2.x - p1.x, dy = p2.y - p1.y;
                const len = Math.sqrt(dx * dx + dy * dy);
                const nx = -dy / len, ny = dx / len;
                const edgeData = validEdges[i];
                const sMeters = edgeData.isRoad ? parseFloat(setbacks.front || 0) : parseFloat(setbacks.side || 0);
                const sPx = sMeters * pxPerMeter;
                offsetLines.push({
                    p1: { x: p1.x + nx * sPx, y: p1.y + ny * sPx }, p2: { x: p2.x + nx * sPx, y: p2.y + ny * sPx }, dx, dy
                });
            }

            const innerPoints = [];
            for (let i = 0; i < N; i++) {
                const line1 = offsetLines[(i - 1 + N) % N], line2 = offsetLines[i];
                const x1 = line1.p1.x, y1 = line1.p1.y, x2 = line1.p2.x, y2 = line1.p2.y;
                const x3 = line2.p1.x, y3 = line2.p1.y, x4 = line2.p2.x, y4 = line2.p2.y;
                const denom = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);
                if (Math.abs(denom) < 0.001) innerPoints.push(line2.p1); 
                else {
                    const ix = ((x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4)) / denom;
                    const iy = ((x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4)) / denom;
                    innerPoints.push({ x: ix, y: iy });
                }
            }

            let innerAreaPx = 0;
            if (innerPoints.length >= 3) {
                for (let i = 0; i < innerPoints.length; i++) {
                    const p1 = innerPoints[i], p2 = innerPoints[(i + 1) % innerPoints.length];
                    innerAreaPx += (p1.x * p2.y - p2.x * p1.y);
                }
                innerAreaPx = Math.abs(innerAreaPx) / 2;
            }
            const innerAreaMeters = Math.max(0, innerAreaPx / (pxPerMeter * pxPerMeter));

            const renderEdges = [];
            for (let i = 0; i < N; i++) {
                const nextI = (i + 1) % N, prevI = (i - 1 + N) % N, edge = validEdges[i];
                const outP1 = outerPoints[i], outP2 = outerPoints[nextI];
                const midAngle = Math.atan2((outP1.y + outP2.y)/2 - center, (outP1.x + outP2.x)/2 - center);
                const labelDist = radius + 15; 
                const iconDist = radius + 35;

                const sPrevMeters = parseFloat(validEdges[prevI].isRoad ? setbacks.front : setbacks.side) || 0;
                const sNextMeters = parseFloat(validEdges[nextI].isRoad ? setbacks.front : setbacks.side) || 0;
                const inValMeters = Math.max(0, edge.val - sPrevMeters - sNextMeters);
                const displayInVal = Number.isInteger(inValMeters) ? inValMeters : inValMeters.toFixed(1);

                const inP1 = innerPoints[i], inP2 = innerPoints[nextI];
                const inMidX = (inP1.x + inP2.x) / 2, inMidY = (inP1.y + inP2.y) / 2;
                const pushIn = 12; 
                const inAngle = Math.atan2(inMidY - center, inMidX - center);
                
                renderEdges.push({
                    ...edge,
                    outStartX: outP1.x, outStartY: outP1.y, outEndX: outP2.x, outEndY: outP2.y,
                    outLabelX: center + labelDist * Math.cos(midAngle), outLabelY: center + labelDist * Math.sin(midAngle),
                    iconX: center + iconDist * Math.cos(midAngle), iconY: center + iconDist * Math.sin(midAngle),
                    inLabelX: inMidX - pushIn * Math.cos(inAngle), inLabelY: inMidY - pushIn * Math.sin(inAngle),
                    displayInVal
                });
            }

            return (
                <div className="w-full mt-4 relative bg-[#0f172a] rounded-2xl overflow-hidden border border-slate-800 shadow-inner flex flex-col items-center py-6 blueprint-bg">
                    <h4 className="absolute top-4 left-4 text-[10px] font-black text-blue-400 uppercase tracking-widest flex items-center gap-2 z-10">
                        <MapIcon className="w-3 h-3" /> Arsa & İnşaat Sınırı
                    </h4>
                    <svg width={size} height={size} className="overflow-visible z-10 drop-shadow-2xl">
                        <polygon points={outerPoints.map(p=>`${p.x},${p.y}`).join(' ')} fill="rgba(30, 41, 59, 0.9)" stroke="#334155" strokeWidth="2" />
                        <polygon points={innerPoints.map(p=>`${p.x},${p.y}`).join(' ')} fill="rgba(59, 130, 246, 0.2)" stroke="#60a5fa" strokeWidth="2" strokeDasharray="5,5" />
                        {renderEdges.map((ed, i) => (
                            <g key={i}>
                                {ed.isRoad && <line x1={ed.outStartX} y1={ed.outStartY} x2={ed.outEndX} y2={ed.outEndY} stroke="#FF8C00" strokeWidth="5" strokeLinecap="round" />}
                                <line x1={ed.outStartX} y1={ed.outStartY} x2={ed.outEndX} y2={ed.outEndY} stroke={ed.isRoad ? "#fff" : "#94a3b8"} strokeWidth={ed.isRoad ? "1" : "2"} />
                                <text x={ed.outLabelX} y={ed.outLabelY} fill={ed.isRoad ? "#FF8C00" : "#cbd5e1"} fontSize="11" fontWeight="bold" textAnchor="middle" dominantBaseline="middle">{ed.val}m</text>
                                {ed.displayInVal > 0 && <text x={ed.inLabelX} y={ed.inLabelY} fill="#93c5fd" fontSize="10" fontWeight="black" textAnchor="middle" dominantBaseline="middle" paintOrder="stroke" stroke="#0f172a" strokeWidth="3">{ed.displayInVal}m</text>}
                                {ed.isRoad && <text x={ed.iconX} y={ed.iconY} fill="#FF8C00" fontSize="9" fontWeight="black" textAnchor="middle" dominantBaseline="middle">YOL</text>}
                            </g>
                        ))}
                        {innerAreaMeters > 0 && (
                            <g className="animate-fade-in">
                                <text x={center} y={center - 5} fill="#fbbf24" fontSize="16" fontWeight="black" textAnchor="middle" dominantBaseline="middle" paintOrder="stroke" stroke="#0f172a" strokeWidth="4">
                                    {innerAreaMeters.toFixed(1)} m²
                                </text>
                                <text x={center} y={center + 12} fill="#cbd5e1" fontSize="8" fontWeight="bold" textAnchor="middle" dominantBaseline="middle" className="uppercase tracking-widest" paintOrder="stroke" stroke="#0f172a" strokeWidth="3">
                                    NET OTURUM
                                </text>
                            </g>
                        )}
                    </svg>
                </div>
            );
        };

        // --- TAM MATEMATİKSEL ODA YERLEŞİM (CAD) MOTORU ---
        
        // Ana Layout Grid Taşıyıcısı: Flex oranlarına göre W ve H'yi matematikle kusursuz parçalar.
        const LayoutBox = ({ dir = 'row', flex = 1, realW = 0, realH = 0, reverse = false, children }) => {
            const kids = React.Children.toArray(children).filter(Boolean);
            const totalFlex = kids.reduce((sum, child) => sum + (child.props.flex || 1), 0);
            
            // Eğer reverse true ise CSS flex-direction row-reverse / column-reverse olur.
            // Bu sayede dış cephe (manzara) dairenin neresindeyse oraya hizalanır.
            const flexDirection = `${dir}${reverse ? '-reverse' : ''}`;

            return (
                <div style={{ flex, display: 'flex', flexDirection }} className="w-full h-full">
                    {kids.map((child, idx) => {
                        const childFlex = child.props.flex || 1;
                        const fraction = childFlex / totalFlex;
                        // Matematiksel kesin alan boyutları
                        const childW = dir === 'row' ? realW * fraction : realW;
                        const childH = dir === 'column' ? realH * fraction : realH;
                        
                        return React.cloneElement(child, {
                            realW: childW,
                            realH: childH,
                            key: idx
                        });
                    })}
                </div>
            );
        };

        // Çizilen Kutucuk: Flexbox Grid'den aldığı kusursuz W ve H değerlerini alana çevirip ekrana yazar.
        const Room = ({ flex, realW = 0, realH = 0, name, bg, isEntrance, doorSide, isBalcony, isCorridor }) => {
            const area = realW * realH;
            
            let borderClass = "border border-slate-400";
            if (isBalcony) borderClass = "border-[3px] border-dashed border-emerald-400 z-10";
            if (isCorridor) borderClass = "border border-slate-300"; 
            
            if (isEntrance) {
                if (doorSide === 'right') borderClass += " border-r-[8px] border-r-[#ea580c] z-20";
                else if (doorSide === 'left') borderClass += " border-l-[8px] border-l-[#ea580c] z-20";
            }

            return (
                <div style={{ flex }} className={`flex flex-col items-center justify-center relative overflow-hidden ${bg} ${borderClass}`}>
                    {isEntrance && (
                        <div className={`absolute bg-[#ea580c] text-white text-[7px] md:text-[9px] font-black px-1.5 py-2 flex items-center justify-center tracking-widest ${doorSide === 'right' ? 'right-0 top-1/2 -translate-y-1/2 rounded-l' : 'left-0 top-1/2 -translate-y-1/2 rounded-r'}`}>
                            <span className={doorSide === 'right' ? 'vertical-text' : 'vertical-text rotate-180'}>KAPI</span>
                        </div>
                    )}
                    <span className={`text-[9px] sm:text-[11px] font-black text-center px-1 leading-tight z-10 drop-shadow-sm ${isBalcony ? 'text-emerald-800' : 'text-slate-800'}`}>
                        {name}
                    </span>
                    <span className="text-[10px] sm:text-xs font-black text-slate-700 z-10 mt-1">{area.toFixed(1)}m²</span>
                    <span className="text-[8px] sm:text-[9px] text-slate-600 z-10 font-bold whitespace-nowrap bg-white/50 px-1 rounded mt-0.5">
                        {realW.toFixed(2)}m x {realH.toFixed(2)}m
                    </span>
                </div>
            );
        };

        const DairePlan = ({ odaTipi, netArea, kitchenType, side, totalW, totalH }) => {
            const doorSide = side === 'left' ? 'right' : 'left';
            const reverse = side === 'right'; // Sağ dairenin dış cephesini sağa almak için LayoutBox reverse edilir

            if (odaTipi === '1+1') {
                if (kitchenType === 'açık') {
                    return (
                        <LayoutBox dir="row" flex={1} realW={totalW} realH={totalH} reverse={reverse}>
                            <LayoutBox dir="column" flex={6.5}>
                                <LayoutBox dir="row" flex={6} reverse={reverse}>
                                    <Room flex={3} name="Balkon" bg="bg-emerald-50/80" isBalcony />
                                    <Room flex={7} name="Salon + Açık Mutfak" bg="bg-amber-100" />
                                </LayoutBox>
                                <Room flex={4} name="Yatak Odası" bg="bg-blue-100" />
                            </LayoutBox>
                            <LayoutBox dir="column" flex={3.5}>
                                <Room flex={6} name="Banyo" bg="bg-teal-100" />
                                <Room flex={4} name="Antre" bg="bg-slate-200" isEntrance doorSide={doorSide} />
                            </LayoutBox>
                        </LayoutBox>
                    );
                } else {
                    return (
                        <LayoutBox dir="row" flex={1} realW={totalW} realH={totalH} reverse={reverse}>
                            <LayoutBox dir="column" flex={6.5}>
                                <LayoutBox dir="row" flex={5.5} reverse={reverse}>
                                    <Room flex={2.5} name="Balkon" bg="bg-emerald-50/80" isBalcony />
                                    <Room flex={7.5} name="Salon" bg="bg-amber-100" />
                                </LayoutBox>
                                <Room flex={4.5} name="Yatak Odası" bg="bg-blue-100" />
                            </LayoutBox>
                            <LayoutBox dir="column" flex={3.5}>
                                <Room flex={3.5} name="Banyo" bg="bg-teal-100" />
                                <Room flex={3.5} name="Ayrı Mutfak" bg="bg-orange-100" />
                                <Room flex={3.0} name="Antre" bg="bg-slate-200" isEntrance doorSide={doorSide} />
                            </LayoutBox>
                        </LayoutBox>
                    );
                }
            }
            if (odaTipi === '2+1') return (
                <LayoutBox dir="column" flex={1} realW={totalW} realH={totalH}>
                    <LayoutBox dir="row" flex={4.5} reverse={reverse}>
                        <LayoutBox dir="row" flex={7} reverse={reverse}>
                            <Room flex={2.5} name="Balkon" bg="bg-emerald-50/80" isBalcony />
                            <Room flex={7.5} name="Salon" bg="bg-amber-100" />
                        </LayoutBox>
                        <Room flex={3} name="Mutfak" bg="bg-orange-50" />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={1.5} reverse={reverse}>
                        <Room flex={7} name="Gece Holü (Koridor)" bg="bg-slate-100/50" isCorridor />
                        <Room flex={3} name="Giriş Antre" bg="bg-slate-200" isEntrance doorSide={doorSide} />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={4} reverse={reverse}>
                        <LayoutBox dir="row" flex={7} reverse={reverse}>
                            <Room flex={4.5} name="Yatak Odası" bg="bg-blue-50" />
                            <Room flex={5.5} name="Ebeveyn Y.O." bg="bg-blue-100" />
                        </LayoutBox>
                        <Room flex={3} name="Banyo" bg="bg-teal-50" />
                    </LayoutBox>
                </LayoutBox>
            );
            if (odaTipi === '3+1') return (
                <LayoutBox dir="column" flex={1} realW={totalW} realH={totalH}>
                    <LayoutBox dir="row" flex={4.5} reverse={reverse}>
                        <LayoutBox dir="row" flex={7} reverse={reverse}>
                            <Room flex={2} name="Balkon" bg="bg-emerald-50/80" isBalcony />
                            <Room flex={8} name="Salon" bg="bg-amber-100" />
                        </LayoutBox>
                        <Room flex={3} name="Mutfak" bg="bg-orange-50" />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={1.5} reverse={reverse}>
                        <Room flex={7} name="Uzun Koridor" bg="bg-slate-100/50" isCorridor />
                        <Room flex={3} name="Giriş Antre" bg="bg-slate-200" isEntrance doorSide={doorSide} />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={4} reverse={reverse}>
                        <LayoutBox dir="row" flex={7} reverse={reverse}>
                            <Room flex={4} name="Ebeveyn Y.O." bg="bg-blue-100" />
                            <Room flex={3} name="Oda 1" bg="bg-blue-50" />
                            <Room flex={3} name="Oda 2" bg="bg-blue-50" />
                        </LayoutBox>
                        <LayoutBox dir="column" flex={3}>
                            <Room flex={6} name="Genel Banyo" bg="bg-teal-50" />
                            <Room flex={4} name="Eb. Banyo" bg="bg-teal-100" />
                        </LayoutBox>
                    </LayoutBox>
                </LayoutBox>
            );
            if (odaTipi === '4+1') return (
                <LayoutBox dir="column" flex={1} realW={totalW} realH={totalH}>
                    <LayoutBox dir="row" flex={4} reverse={reverse}>
                        <LayoutBox dir="row" flex={7.5} reverse={reverse}>
                            <Room flex={2} name="Ana Balkon" bg="bg-emerald-50/80" isBalcony />
                            <Room flex={8} name="Salon" bg="bg-amber-100" />
                        </LayoutBox>
                        <Room flex={2.5} name="Mutfak" bg="bg-orange-50" />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={1.5} reverse={reverse}>
                        <Room flex={7.5} name="Geniş Koridor" bg="bg-slate-100/50" isCorridor />
                        <Room flex={2.5} name="Giriş Antre" bg="bg-slate-200" isEntrance doorSide={doorSide} />
                    </LayoutBox>
                    <LayoutBox dir="row" flex={4.5} reverse={reverse}>
                        <LayoutBox dir="row" flex={7.5} reverse={reverse}>
                            <LayoutBox dir="column" flex={3.5}>
                                <Room flex={7} name="Ebeveyn Y.O." bg="bg-blue-100" />
                                <LayoutBox dir="row" flex={3} reverse={reverse}>
                                    <Room flex={1} name="Giyinme" bg="bg-indigo-50" />
                                    <Room flex={1} name="Eb. Banyo" bg="bg-teal-100" />
                                </LayoutBox>
                            </LayoutBox>
                            <Room flex={2} name="Oda 1" bg="bg-blue-50" />
                            <Room flex={2} name="Oda 2" bg="bg-blue-50" />
                            <Room flex={2} name="Oda 3" bg="bg-blue-50" />
                        </LayoutBox>
                        <LayoutBox dir="column" flex={2.5}>
                            <Room flex={5} name="Genel Banyo" bg="bg-teal-50" />
                            <Room flex={3} name="WC" bg="bg-teal-100" />
                            <Room flex={2} name="Çamaşır" bg="bg-indigo-50" />
                        </LayoutBox>
                    </LayoutBox>
                </LayoutBox>
            );
            return null;
        }

        const FloorPlanModal = ({ scenario, ozet, onClose }) => {
            if (!scenario) return null;
            const [kitchenType, setKitchenType] = useState('açık'); 

            const ratio = ozet.aspectRatio || 1;
            const isNarrow = ratio > 2.5;
            const area = Math.round(ozet.normalKatBrutKapasite);
            const coreArea = Math.round(area * (1 - (1 / ozet.brutMultiplier)));
            const flats = Array.from({ length: scenario.normalCount }).map((_, i) => i + 1);
            
            const splitLayout = !isNarrow && flats.length > 1;
            const leftFlats = splitLayout ? flats.slice(0, Math.ceil(flats.length / 2)) : flats;
            const rightFlats = splitLayout ? flats.slice(Math.ceil(flats.length / 2)) : [];

            const CoreBlock = () => {
                const isHorizontal = isNarrow || !splitLayout;
                return (
                    <div className={`bg-slate-200 border-[3px] border-slate-500 flex ${isHorizontal ? 'flex-row' : 'flex-col'} shadow-inner shrink-0 relative`} style={{ [isHorizontal ? 'minHeight' : 'minWidth']: '140px', [isHorizontal ? 'width' : 'height']: '100%' }}>
                        <div className={`flex-1 bg-slate-50 border border-slate-300 flex items-center justify-center relative shadow-inner`}>
                            <div className={`absolute ${isHorizontal ? 'inset-x-0 h-12' : 'inset-y-0 w-12'} bg-orange-50/40 border-${isHorizontal ? 'y' : 'x'} border-orange-200/50 m-auto`}></div> 
                            <span className={`text-[10px] md:text-xs font-black tracking-[0.3em] text-slate-400 ${isHorizontal ? '' : '-rotate-90'} whitespace-nowrap z-10`}>MERKEZİ KAT HOLÜ</span>
                            <span className="text-[10px] font-bold text-slate-500 absolute bottom-2 right-2 z-10 bg-white/90 px-2 py-0.5 rounded shadow-sm">Ortak: ~{coreArea}m²</span>
                        </div>
                        <div className={`flex ${isHorizontal ? 'flex-col' : 'flex-row'} bg-slate-300 border border-slate-400 p-1.5 gap-1.5 shadow-sm`} style={{ [isHorizontal ? 'width' : 'height']: '160px' }}>
                            <div className="flex-1 border border-slate-500 relative overflow-hidden flex items-center justify-center bg-slate-100 shadow-inner">
                                <div className="absolute inset-0 stairs-pattern opacity-60"></div>
                                <span className="z-10 bg-white/90 px-1.5 py-0.5 text-[9px] font-black tracking-widest text-slate-800 rounded border border-slate-300 shadow-sm">MERDİVEN</span>
                            </div>
                            <div className="flex-1 border border-slate-500 bg-slate-400 relative flex items-center justify-center shadow-inner shrink-0">
                                <X className="absolute inset-0 w-full h-full text-slate-600 opacity-40 p-1" />
                                <span className="z-10 bg-slate-300/90 px-1.5 py-0.5 text-[8px] font-black text-slate-900 rounded border border-slate-500">ASANSÖR</span>
                            </div>
                        </div>
                    </div>
                );
            };

            const FlatBox = ({ num, side }) => {
                const isHorizontal = isNarrow || !splitLayout;
                
                // Gerçekçi Kat Planı En/Boy oranı (Matematiksel alan W*H = netArea)
                const aspectRatios = { '1+1': 1.3, '2+1': 1.5, '3+1': 1.6, '4+1': 1.8 };
                let flatRatio = aspectRatios[scenario.odaTipi];
                if (!isHorizontal) flatRatio = 1 / flatRatio; // Dikey/Yatay yerleşime göre çevir

                const totalW = Math.sqrt(scenario.normalNet * flatRatio);
                const totalH = scenario.normalNet / totalW;

                return (
                    <div className="bg-white border-[4px] border-slate-700 flex flex-col relative overflow-hidden flex-1 shadow-lg group min-h-[300px]">
                        <div className="bg-slate-800 text-white px-3 py-2 flex justify-between items-center z-20 shadow-sm shrink-0">
                            <div className="text-xs font-black flex items-center gap-2">
                                DAİRE {num} <span className="opacity-50 font-medium text-[10px]">| {scenario.odaTipi}</span>
                            </div>
                            <div className="text-[10px] font-bold text-blue-300">
                                Net: {Math.round(scenario.normalNet)}m² <span className="opacity-70 font-medium text-[8px] ml-1">(Brüt: {Math.round(scenario.normalBrut)}m²)</span>
                            </div>
                        </div>
                        <div className="flex-1 relative bg-slate-50/50 block">
                            <DairePlan odaTipi={scenario.odaTipi} netArea={scenario.normalNet} kitchenType={kitchenType} side={side} totalW={totalW} totalH={totalH} />
                            
                            <div className="absolute bottom-1 left-1 bg-slate-800/95 text-white px-2 py-1 text-[9px] font-black z-20 rounded shadow border border-slate-700 backdrop-blur-md">
                                Daire Dış Ölçü: {totalW.toFixed(2)}m x {totalH.toFixed(2)}m
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="fixed inset-0 bg-slate-900/95 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4 animate-fade-in">
                    <div className="bg-white rounded-[1.5rem] w-full max-w-6xl shadow-2xl overflow-hidden flex flex-col max-h-[98vh]">
                        
                        <div className="p-3 sm:p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0 gap-2 relative">
                            <div className="flex items-center gap-4 flex-wrap w-full pr-8">
                                <h3 className="text-base font-black text-slate-800 flex items-center gap-2">
                                    <PenTool className="w-4 h-4 text-[#1D63CB]" /> Matematiksel Kat Planı (Blueprint)
                                </h3>
                                {scenario.odaTipi === '1+1' && (
                                    <div className="flex items-center bg-slate-200 p-1 rounded-lg">
                                        <button onClick={() => setKitchenType('açık')} className={`px-3 py-1 text-[10px] font-bold rounded-md transition-colors ${kitchenType === 'açık' ? 'bg-white shadow-sm text-[#1D63CB]' : 'text-slate-500 hover:text-slate-700'}`}>Açık Mutfak</button>
                                        <button onClick={() => setKitchenType('kapalı')} className={`px-3 py-1 text-[10px] font-bold rounded-md transition-colors ${kitchenType === 'kapalı' ? 'bg-white shadow-sm text-[#1D63CB]' : 'text-slate-500 hover:text-slate-700'}`}>Kapalı Mutfak</button>
                                    </div>
                                )}
                            </div>
                            <button onClick={onClose} className="p-2 bg-white border border-slate-200 rounded-xl hover:bg-red-50 hover:text-red-500 transition-colors shrink-0 absolute right-3 top-3 sm:relative sm:right-0 sm:top-0">
                                <X className="w-5 h-5" />
                            </button>
                        </div>
                        
                        <div className="flex-1 overflow-auto hide-scrollbar p-2 md:p-6 bg-slate-200/80 blueprint-bg flex items-start md:items-center justify-start md:justify-center">
                            <div className="w-full min-w-[700px] max-w-5xl bg-slate-100 border-[6px] border-slate-800 shadow-2xl rounded-xl p-2 md:p-3 flex gap-2 md:gap-3 min-h-[450px]" style={{ flexDirection: isNarrow || !splitLayout ? 'column' : 'row' }}>
                                {leftFlats.length > 0 && <div className={`flex-1 flex ${isNarrow ? 'flex-row' : 'flex-col'} gap-2 md:gap-3`}>{leftFlats.map(num => <FlatBox key={num} num={num} side="left" />)}</div>}
                                <CoreBlock />
                                {rightFlats.length > 0 && <div className={`flex-1 flex ${isNarrow ? 'flex-row' : 'flex-col'} gap-2 md:gap-3`}>{rightFlats.map(num => <FlatBox key={num} num={num} side="right" />)}</div>}
                            </div>
                        </div>

                        <div className="p-2 sm:p-3 bg-white border-t border-slate-100 flex flex-wrap justify-center sm:justify-between items-center gap-2 sm:gap-4 shrink-0 shadow-[0_-10px_15px_-3px_rgba(0,0,0,0.05)] z-10 relative">
                            <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                                <span className="text-[9px] text-slate-400 font-bold uppercase">Toplam Daire:</span>
                                <span className="text-sm font-black text-slate-800">{scenario.normalCount}</span>
                            </div>
                            <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                                <span className="text-[9px] text-slate-400 font-bold uppercase">Daire Net/Brüt:</span>
                                <span className="text-sm font-black text-[#1D63CB]">{Math.round(scenario.normalNet)}m² / {Math.round(scenario.normalBrut)}m²</span>
                            </div>
                            <div className="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                                <span className="text-[9px] text-slate-400 font-bold uppercase">Esneme:</span>
                                <span className={`text-sm font-black ${scenario.changePercent > 0 ? 'text-green-500' : scenario.changePercent < 0 ? 'text-orange-500' : 'text-slate-800'}`}>
                                    {scenario.changePercent > 0 ? '+' : ''}{scenario.changePercent.toFixed(1)}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const EmlaknomiLogo = () => (
            <div className="relative w-16 h-16 bg-[#1D63CB] rounded-2xl flex items-center justify-center shadow-lg overflow-hidden shrink-0 border-b-4 border-blue-800">
                <div className="relative w-12 h-12 bg-[#FF8C00] rounded-full flex items-center justify-center border-2 border-white shadow-inner">
                    <Building2 className="w-7 h-7 text-white" />
                    <div className="absolute -bottom-1 -right-1 bg-white rounded-full p-1 shadow-sm">
                        <MapPin className="w-3 h-3 text-[#1D63CB]" />
                    </div>
                </div>
            </div>
        );

        function App() {
            const [params, setParams] = useState({
                arsaAlani: '', yolaTerkDeger: '', yolaTerkBirim: 'm2', emsal: '', taks: '', katSayisi: '', katBirim: 'kat', nizamTipi: 'Ayrık'
            });

            const [advancedMode, setAdvancedMode] = useState(false);
            const [setbacks, setSetbacks] = useState({ front: 5, side: 3 });
            const [edges, setEdges] = useState([
                { id: 1, length: '', isRoad: true }, { id: 2, length: '', isRoad: false }, { id: 3, length: '', isRoad: false }, { id: 4, length: '', isRoad: false }
            ]);
            
            const [appliedGeoData, setAppliedGeoData] = useState(null);
            const [geoCalcArea, setGeoCalcArea] = useState(0);

            const [sepet, setSepet] = useState({});
            const [toastMessage, setToastMessage] = useState("");
            const [selectedFloorPlan, setSelectedFloorPlan] = useState(null); 
            
            const [ozet, setOzet] = useState({
                emsalAlani: 0, kullanilabilirEmsal: 0, kayipEmsal: 0, toplamBrutKapasite: 0, kullanilanM2: 0, dolulukOrani: 0,
                netArsa: 0, toplamDaire: 0, toplamNetM2: 0, katSayisi: 0, zeminBrutKapasite: 0, normalKatBrutKapasite: 0,
                bucukKatBrutKapasite: 0, normalKatAdeti: 0, hasBucukKat: false, geoLimitActive: false, geoInfo: null,
                aspectRatio: 1, brutMultiplier: 1.30, yerlesimUygun: true
            });

            const handleParamChange = (e) => {
                const { name, value } = e.target;
                if (name !== 'nizamTipi' && name !== 'yolaTerkBirim' && name !== 'katBirim') setParams(prev => ({ ...prev, [name]: value === '' ? '' : parseFloat(value) }));
                else setParams(prev => ({ ...prev, [name]: value }));
            };

            const updateAdet = (odaTipi, boyut, delta) => {
                const key = `${odaTipi}-${boyut}`;
                const daireData = DAİRE_STANDARTLARI[odaTipi][boyut];
                setSepet(prev => {
                    const mevcut = prev[key] || { adet: 0, odaTipi, boyut, ...daireData };
                    const yeniAdet = Math.max(0, mevcut.adet + delta);
                    if (delta > 0) {
                        const testSepet = { ...prev, [key]: { ...mevcut, adet: yeniAdet } };
                        if (!checkKapasite(testSepet, ozet)) return prev; 
                    }
                    return { ...prev, [key]: { ...mevcut, adet: yeniAdet } };
                });
            };

            const handleGeoCalculate = () => {
                if (!params.arsaAlani || parseFloat(params.arsaAlani) <= 0) {
                    setToastMessage("Önce Arsa Alanı bilgisini girmelisiniz!"); setTimeout(() => setToastMessage(""), 3500); return;
                }
                const validEdges = edges.filter(e => parseFloat(e.length) > 0);
                if (validEdges.length < 3) {
                    setToastMessage("Hesaplama için en az 3 kenar girmelisiniz!"); setTimeout(() => setToastMessage(""), 3500); return;
                }

                const totalL = validEdges.reduce((sum, e) => sum + parseFloat(e.length), 0);
                const maxE = Math.max(...validEdges.map(e => parseFloat(e.length)));
                if (maxE >= totalL - maxE) {
                    setToastMessage("Hatalı Ölçü! Bu kenarlar birleşerek kapalı bir arsa oluşturamaz."); setTimeout(() => setToastMessage(""), 4500); return;
                }
                
                let totalLoss = 0; let sumSetbacks = 0;
                validEdges.forEach(e => {
                    const l = parseFloat(e.length) || 0;
                    const s = e.isRoad ? parseFloat(setbacks.front || 0) : parseFloat(setbacks.side || 0);
                    totalLoss += (l * s); sumSetbacks += s;
                });
                const avgS = sumSetbacks / validEdges.length;
                let calcArea = parseFloat(params.arsaAlani) - totalLoss + (Math.PI * Math.pow(avgS, 2));
                calcArea = Math.max(0, Math.min(parseFloat(params.arsaAlani), calcArea));
                
                setGeoCalcArea(calcArea);
                setAppliedGeoData({ edges: validEdges, setbacks: { ...setbacks } });
                setToastMessage("Sınırlar hesaplandı ve kapasiteye uygulandı!"); setTimeout(() => setToastMessage(""), 3500);
            };

            const handleGeoReset = () => {
                setAppliedGeoData(null); setGeoCalcArea(0);
                setEdges([{ id: 1, length: '', isRoad: true }, { id: 2, length: '', isRoad: false }, { id: 3, length: '', isRoad: false }, { id: 4, length: '', isRoad: false }]);
                setSetbacks({ front: 5, side: 3 });
                setToastMessage("Sınırlar sıfırlandı. Standart hesaba dönüldü."); setTimeout(() => setToastMessage(""), 3500);
            };

            useEffect(() => {
                const arsaVal = parseFloat(params.arsaAlani) || 0;
                const terkVal = parseFloat(params.yolaTerkDeger) || 0;
                let emsalVal = parseFloat(params.emsal) || 0;
                let taksVal = parseFloat(params.taks) || 0;
                let rawKat = parseFloat(params.katSayisi) || 0; 
                let isMetre = params.katBirim === 'metre';

                if (taksVal > 1) taksVal = taksVal >= 10 ? taksVal / 100 : taksVal / 10;
                if (emsalVal > 10) emsalVal = emsalVal >= 100 ? emsalVal / 100 : emsalVal / 10;
                
                let finalKatVal = 1; 
                if (rawKat > 0) {
                    finalKatVal = isMetre ? Math.round((rawKat / 3) * 2) / 2 : rawKat;
                    finalKatVal = Math.max(0.5, finalKatVal); 
                }

                let netArsa = arsaVal;
                if (params.yolaTerkBirim === '%') netArsa = arsaVal * (1 - terkVal / 100);
                else netArsa = Math.max(0, arsaVal - terkVal);

                let emsalAlani = netArsa * emsalVal;
                let maksTaksNet = netArsa * taksVal; 
                let fizikselZeminNet = maksTaksNet;
                let geoLimitActive = false;
                let currentGeoInfo = null;
                let arsaOrani = 1; 
                let brutMultiplier = 1.30; 

                if (advancedMode && appliedGeoData && appliedGeoData.edges.length >= 3) {
                    const totalL = appliedGeoData.edges.reduce((sum, e) => sum + parseFloat(e.length), 0);
                    const maxE = Math.max(...appliedGeoData.edges.map(e => parseFloat(e.length)));
                    const estimatedWidth = (totalL / 2) - maxE;
                    if (estimatedWidth > 0) arsaOrani = maxE / estimatedWidth;
                    if (arsaOrani > 2.5) brutMultiplier = 1.40; 

                    let totalLoss = 0; let sumSetbacks = 0;
                    appliedGeoData.edges.forEach(e => {
                        const l = parseFloat(e.length) || 0;
                        const s = e.isRoad ? parseFloat(appliedGeoData.setbacks.front || 0) : parseFloat(appliedGeoData.setbacks.side || 0);
                        totalLoss += (l * s); sumSetbacks += s;
                    });
                    const avgS = sumSetbacks / appliedGeoData.edges.length;
                    let calcArea = netArsa - totalLoss + (Math.PI * Math.pow(avgS, 2));
                    calcArea = Math.max(0, Math.min(netArsa, calcArea));

                    if (calcArea < maksTaksNet) {
                        fizikselZeminNet = calcArea; geoLimitActive = true;
                        currentGeoInfo = { type: 'geo', text: `Çekme payları sonrası arsanızın fiziki oturum alanı (${Math.round(calcArea)} m²) TAKS sınırından (${Math.round(maksTaksNet)} m²) küçük olduğu için bina fiziki olarak daraltıldı!` };
                    } else {
                        currentGeoInfo = { type: 'taks', text: `Çekme payları hesaplandı. Kalan fiziksel alan (${Math.round(calcArea)} m²), kanuni TAKS sınırınızdan BÜYÜK. Bu yüzden TAKS kuralları geçerli oldu.` };
                    }
                    if (arsaOrani > 2.5) currentGeoInfo.text += ` Ayrıca arsa şekli (İnce Uzun) olduğu için koridor kayıpları hesaba katılarak ortak alan (brüt) payı %30'dan %40'a çıkarıldı.`;
                } else if (!advancedMode) {
                    setAppliedGeoData(null); 
                }

                let zeminKatCarpan = Math.min(1, finalKatVal);
                let zeminBrutKapasite = Math.min(fizikselZeminNet * zeminKatCarpan, emsalAlani * brutMultiplier);
                let maxUstKatNet = fizikselZeminNet * 1.20; 
                let toplamBrutHakkı = emsalAlani * brutMultiplier;
                let kalanBrutHakkı = Math.max(0, toplamBrutHakkı - zeminBrutKapasite);
                let ustKatSayisi = Math.max(0, finalKatVal - zeminKatCarpan);
                let kalanEmsal = Math.max(0, kalanBrutHakkı / brutMultiplier);
                let istenilenUstKatNet = ustKatSayisi > 0 ? (kalanEmsal / ustKatSayisi) : 0;
                let gerceklesenUstKatNet = Math.min(istenilenUstKatNet, maxUstKatNet);

                let normalKatAdeti = Math.floor(ustKatSayisi);
                let bucukKisim = ustKatSayisi - normalKatAdeti;
                let hasBucukKat = bucukKisim > 0;

                let normalKatBrutKapasite = 0, bucukKatBrutKapasite = 0, gerceklesenToplamBrut = zeminBrutKapasite;

                if (ustKatSayisi > 0) {
                    let istenilenNormalBrut = kalanBrutHakkı / ustKatSayisi;
                    normalKatBrutKapasite = Math.min(istenilenNormalBrut, maxUstKatNet * brutMultiplier);
                    bucukKatBrutKapasite = hasBucukKat ? (normalKatBrutKapasite * bucukKisim) : 0;
                    gerceklesenToplamBrut += (normalKatBrutKapasite * normalKatAdeti) + bucukKatBrutKapasite;
                }

                let kullanilabilirEmsal = gerceklesenToplamBrut / brutMultiplier;
                let kayipEmsal = Math.max(0, emsalAlani - kullanilabilirEmsal);
                let suanKullanilanBrut = 0, suanNetM2 = 0, suanToplamDaire = 0;

                Object.values(sepet).forEach(d => {
                    suanKullanilanBrut += (d.adet * d.brut); suanNetM2 += (d.adet * d.net); suanToplamDaire += d.adet;
                });
                
                const newOzet = {
                    emsalAlani, kullanilabilirEmsal, kayipEmsal, toplamBrutKapasite: gerceklesenToplamBrut, kullanilanM2: suanKullanilanBrut,
                    dolulukOrani: gerceklesenToplamBrut > 0 ? (suanKullanilanBrut / gerceklesenToplamBrut) * 100 : 0, netArsa, toplamDaire: suanToplamDaire,
                    toplamNetM2: suanNetM2, katSayisi: rawKat > 0 ? finalKatVal : 0, zeminBrutKapasite, normalKatBrutKapasite, bucukKatBrutKapasite,
                    normalKatAdeti, hasBucukKat, geoLimitActive, geoInfo: currentGeoInfo, aspectRatio: arsaOrani, brutMultiplier, yerlesimUygun: true 
                };

                newOzet.yerlesimUygun = checkKapasite(sepet, newOzet);
                setOzet(newOzet);

            }, [params, sepet, advancedMode, appliedGeoData]);

            return (
                <div className="min-h-screen bg-[#F8FAFC] font-sans text-slate-900 p-4 md:p-8">
                    {FloorPlanModal && <FloorPlanModal scenario={selectedFloorPlan} ozet={ozet} onClose={() => setSelectedFloorPlan(null)} />}
                    {toastMessage && (
                        <div className="fixed bottom-6 right-6 bg-[#1D63CB] text-white px-6 py-4 rounded-2xl shadow-2xl z-50 animate-bounce flex items-center gap-3 print:hidden">
                            <CheckCircle className="w-5 h-5 text-green-300" /> <span className="font-bold text-sm">{toastMessage}</span>
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto space-y-8">
                        <header className="flex flex-col md:flex-row md:items-center justify-between gap-6">
                            <div className="flex items-center gap-5">
                                <EmlaknomiLogo />
                                <div>
                                    <h1 className="text-3xl font-black text-slate-800 tracking-tight capitalize leading-none">Emlaknomi</h1>
                                    <p className="text-[#1D63CB] font-bold text-xs uppercase tracking-[0.2em] mt-1 flex items-center gap-2">
                                        <MapIcon className="w-3 h-3" /> Arsa Hesaplama Programı
                                    </p>
                                </div>
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <aside className="lg:col-span-4 space-y-6">
                                <div className="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-200">
                                    <h2 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 flex items-center gap-2">
                                        <Ruler className="w-4 h-4 text-[#FF8C00]" /> 1. Arsa Bilgilerini Girin
                                    </h2>
                                    <div className="space-y-4">
                                        <div className="group">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-1 transition-colors group-focus-within:text-[#1D63CB]">Arsa Alanı (m²)</label>
                                            <input placeholder="Örn: 1000" type="number" name="arsaAlani" value={params.arsaAlani} onChange={handleParamChange} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-[#1D63CB] focus:bg-white outline-none font-bold mt-1 shadow-sm transition-all" />
                                        </div>

                                        <div className="group">
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-1 group-focus-within:text-[#1D63CB]">Yola Terk Mikarı</label>
                                            <div className="flex mt-1">
                                                <input placeholder="Örn: 10" type="number" name="yolaTerkDeger" value={params.yolaTerkDeger} onChange={handleParamChange} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-l-2xl focus:ring-2 focus:ring-[#1D63CB] focus:bg-white outline-none font-bold shadow-sm" />
                                                <select name="yolaTerkBirim" value={params.yolaTerkBirim} onChange={handleParamChange} className="bg-slate-100 border border-l-0 border-slate-200 rounded-r-2xl px-4 font-bold text-slate-600 outline-none hover:bg-slate-200 transition-colors">
                                                    <option value="m2">m²</option><option value="%">%</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-1">Emsal (KAKS)</label>
                                                <input placeholder="Örn: 1.5" type="number" name="emsal" step="0.1" value={params.emsal} onChange={handleParamChange} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-[#1D63CB] outline-none font-bold mt-1 shadow-sm" />
                                            </div>
                                            <div>
                                                <label className="text-[10px] font-black text-slate-400 uppercase ml-1">TAKS (Oturum)</label>
                                                <input placeholder="Örn: 0.30" type="number" name="taks" step="0.01" value={params.taks} onChange={handleParamChange} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-[#1D63CB] outline-none font-bold mt-1 shadow-sm" />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="text-[10px] font-black text-slate-400 uppercase ml-1">Kat Sayısı / Yükseklik</label>
                                            <div className="flex mt-1">
                                                <input placeholder="Örn: 2 veya 6.5" type="number" step="0.5" name="katSayisi" value={params.katSayisi} onChange={handleParamChange} className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-l-2xl focus:ring-2 focus:ring-[#1D63CB] focus:bg-white outline-none font-bold shadow-sm" />
                                                <select name="katBirim" value={params.katBirim} onChange={handleParamChange} className="bg-slate-100 border border-l-0 border-slate-200 rounded-r-2xl px-2 text-xs font-bold text-slate-600 outline-none hover:bg-slate-200 transition-colors">
                                                    <option value="kat">Kat</option><option value="metre">Metre (H)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="mt-6 border border-slate-200 rounded-2xl overflow-hidden bg-white print:hidden">
                                        <button onClick={() => setAdvancedMode(!advancedMode)} className={`w-full flex items-center justify-between p-4 transition-colors ${ozet.geoLimitActive ? 'bg-orange-50 hover:bg-orange-100' : 'bg-slate-50 hover:bg-slate-100'}`}>
                                            <div className="flex items-center gap-2">
                                                <Settings2 className="w-4 h-4 text-[#1D63CB]" />
                                                <span className="text-[10px] font-black text-slate-600 uppercase tracking-widest text-left">Geometrik Sınır & Çekmeler</span>
                                            </div>
                                            <ChevronDown className={`w-4 h-4 text-slate-400 transition-transform ${advancedMode ? 'rotate-180' : ''}`} />
                                        </button>
                                        
                                        {advancedMode && (
                                            <div className="p-4 space-y-4 border-t border-slate-200 bg-white animate-fade-in">
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div>
                                                        <label className="text-[9px] font-black text-slate-400 uppercase">Ön/Yol Çekme (m)</label>
                                                        <input type="number" placeholder="Örn: 5" value={setbacks.front} onChange={e => setSetbacks({...setbacks, front: e.target.value})} className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold mt-1 text-sm focus:ring-2 focus:ring-[#1D63CB]" />
                                                    </div>
                                                    <div>
                                                        <label className="text-[9px] font-black text-slate-400 uppercase">Yan/Arka Çekme (m)</label>
                                                        <input type="number" placeholder="Örn: 3" value={setbacks.side} onChange={e => setSetbacks({...setbacks, side: e.target.value})} className="w-full px-3 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold mt-1 text-sm focus:ring-2 focus:ring-[#1D63CB]" />
                                                    </div>
                                                </div>
                                                
                                                <div className="space-y-2 pt-2 border-t border-slate-100">
                                                    <label className="text-[9px] font-black text-slate-400 uppercase flex items-center justify-between">
                                                        <span>Arsa Kenarları (Sırayla)</span>
                                                        <span className="text-slate-400 font-medium">Yol cephesi ise işaretleyin</span>
                                                    </label>
                                                    {edges.map((edge, idx) => (
                                                        <div key={edge.id} className="flex items-center gap-2">
                                                            <input type="number" placeholder={`${idx+1}. Kenar (m)`} value={edge.length} onChange={(e) => {
                                                                const newEdges = [...edges]; newEdges[idx].length = e.target.value; setEdges(newEdges);
                                                            }} className="flex-1 px-3 py-2 bg-slate-50 border border-slate-200 rounded-xl outline-none font-bold text-sm focus:ring-2 focus:ring-[#1D63CB]" />
                                                            <label className="flex items-center gap-2 px-3 py-2 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 select-none">
                                                                <input type="checkbox" checked={edge.isRoad} onChange={(e) => {
                                                                    const newEdges = [...edges]; newEdges[idx].isRoad = e.target.checked; setEdges(newEdges);
                                                                }} className="w-4 h-4 rounded text-[#1D63CB] focus:ring-[#1D63CB]" />
                                                                <span className="text-[10px] font-bold text-slate-600">Yol</span>
                                                            </label>
                                                            <button onClick={() => setEdges(edges.filter(e => e.id !== edge.id))} className="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors">
                                                                <Trash2 className="w-4 h-4" />
                                                            </button>
                                                        </div>
                                                    ))}
                                                    <button onClick={() => setEdges([...edges, {id: Date.now(), length: '', isRoad: false}])} className="w-full py-2.5 border-2 border-dashed border-slate-200 rounded-xl text-[10px] font-black text-[#1D63CB] uppercase tracking-widest hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 mt-2">
                                                        <Plus className="w-3 h-3" /> Yeni Kenar Ekle
                                                    </button>
                                                </div>

                                                <PlotSimulation edges={edges} setbacks={setbacks} arsaAlani={params.arsaAlani} hesaplananGeoAlan={geoCalcArea} />

                                                <div className="flex gap-2 mt-4 pt-4 border-t border-slate-100">
                                                    <button onClick={handleGeoReset} className="flex-1 py-3 bg-slate-100 text-slate-500 font-bold rounded-xl text-[10px] uppercase tracking-widest hover:bg-slate-200 transition-colors active:scale-95">Sıfırla</button>
                                                    <button onClick={handleGeoCalculate} className="flex-[2] py-3 bg-[#1D63CB] text-white font-bold rounded-xl text-[10px] uppercase tracking-widest hover:bg-blue-700 transition-colors shadow-md active:scale-95">Hesapla ve Uygula</button>
                                                </div>

                                                {ozet.geoInfo && (
                                                    <div className={`mt-2 p-4 rounded-xl border ${ozet.geoInfo.type === 'geo' ? 'bg-orange-50 border-orange-200 text-orange-800' : 'bg-blue-50 border-blue-200 text-blue-800'}`}>
                                                        <div className="flex items-center gap-2 mb-2 font-black text-[10px] uppercase tracking-wider">
                                                            <Info className="w-4 h-4"/> Hesaplama Analizi
                                                        </div>
                                                        <p className="text-xs font-medium leading-relaxed">{ozet.geoInfo.text}</p>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="bg-[#1D63CB] rounded-[2rem] p-8 text-white shadow-xl relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                                    <div className="relative z-10 space-y-6">
                                        <div>
                                            <div className="flex items-center gap-2 mb-1 text-blue-200">
                                                <Building2 className="w-4 h-4" />
                                                <span className="text-[10px] font-bold uppercase tracking-widest">Toplam Brüt İnşaat</span>
                                            </div>
                                            <div className="text-5xl font-black text-white tracking-tighter">
                                                {Math.round(ozet.toplamBrutKapasite).toLocaleString()} 
                                                <span className="text-xl text-blue-300 ml-2 font-medium">m²</span>
                                            </div>
                                        </div>

                                        <div className="pt-6 border-t border-white/10 space-y-3">
                                            <div className="flex justify-between items-center text-xs">
                                                <span className="text-blue-100/60 font-medium">Hedeflenen Emsal Alanı:</span>
                                                <span className="font-bold text-white">{Math.round(ozet.emsalAlani).toLocaleString()} m²</span>
                                            </div>
                                            
                                            {ozet.zeminBrutKapasite > 0 && (
                                                <div className="flex justify-between items-center text-xs">
                                                    <span className={`font-medium ${ozet.geoLimitActive ? 'text-[#FF8C00] font-bold' : 'text-blue-100/60'}`}>
                                                        Zemin Kat Brüt {ozet.geoLimitActive ? '(Geometrik Sınır!)' : '(TAKS Sınırı)'}:
                                                    </span>
                                                    <span className="font-bold text-white">{Math.round(ozet.zeminBrutKapasite).toLocaleString()} m²</span>
                                                </div>
                                            )}
                                            
                                            {ozet.normalKatAdeti > 0 && (
                                                <div className="flex justify-between items-center text-xs">
                                                    <span className="text-blue-100/60 font-medium">Normal Kat Brüt ({ozet.normalKatAdeti} Adet):</span>
                                                    <span className="font-bold text-white">{Math.round(ozet.normalKatBrutKapasite).toLocaleString()} m²</span>
                                                </div>
                                            )}

                                            {ozet.kayipEmsal > 0 && (
                                                <div className="flex justify-between items-center text-[11px] mt-2 pt-2 border-t border-red-400/30 text-red-300">
                                                    <span className="font-bold flex items-center gap-1"><AlertTriangle className="w-3 h-3"/> Fiziki Emsal Kaybı:</span>
                                                    <span className="font-black">{Math.round(ozet.kayipEmsal).toLocaleString()} m²</span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </aside>

                            <main className="lg:col-span-8 space-y-8">
                                
                                <section className="bg-slate-900 rounded-[2.5rem] p-6 shadow-2xl border border-slate-800 text-white relative overflow-hidden">
                                    <div className="absolute -bottom-10 -left-10 w-40 h-40 bg-blue-500/10 rounded-full blur-3xl"></div>
                                    <div className="relative z-10">
                                        <div className="flex items-center justify-between mb-6">
                                            <h2 className="text-xs font-bold text-[#FF8C00] uppercase tracking-widest flex items-center gap-2">
                                                <LayoutGrid className="w-4 h-4" /> Maksimum Tek Tip Yerleşim (Esnek Ölçü)
                                            </h2>
                                            <span className="text-[10px] bg-slate-800 text-slate-400 px-3 py-1 rounded-full border border-slate-700">±%10 Esneme</span>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
                                            {Object.keys(DAİRE_STANDARTLARI).map((oda) => {
                                                const scenarios = getElasticScenarios(oda, ozet);

                                                return (
                                                    <div key={oda} className="bg-white/5 p-4 rounded-3xl border border-white/10 flex flex-col cursor-default">
                                                        <div className="text-xs font-black text-blue-400 mb-3 uppercase tracking-wider text-center">{oda} Seçenekleri</div>
                                                        <div className="space-y-3">
                                                            {scenarios.map((r, i) => (
                                                                <div key={i} className="bg-slate-800/50 p-4 rounded-2xl border border-white/5 flex flex-col">
                                                                    <div className="flex justify-between items-start mb-2">
                                                                        <div className="text-[10px] text-[#FF8C00] uppercase font-bold">{r.type}</div>
                                                                        <div className="text-xl font-black text-white">{r.totalAdet} <span className="text-[10px] text-white/50">ADET</span></div>
                                                                    </div>
                                                                    
                                                                    <div className="flex items-center gap-2 mt-1">
                                                                        <span className="text-xs font-bold text-blue-200/80">Revize Net: {Math.round(r.normalNet)}m²</span>
                                                                        <span className={`text-[9px] font-black px-1.5 py-0.5 rounded ${r.changePercent > 0 ? 'bg-green-500/20 text-green-400' : r.changePercent < 0 ? 'bg-orange-500/20 text-orange-400' : 'bg-slate-700 text-slate-300'}`}>
                                                                            {r.changePercent > 0 ? '+' : ''}{r.changePercent.toFixed(1)}% {r.changePercent > 0 ? 'Büyüdü' : r.changePercent < 0 ? 'Küçüldü' : 'Tam Sığdı'}
                                                                        </span>
                                                                    </div>

                                                                    <button onClick={() => setSelectedFloorPlan(r)} className="mt-3 w-full py-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 text-[10px] font-black uppercase tracking-widest rounded-xl transition-colors border border-blue-500/30 flex justify-center items-center gap-2">
                                                                        <Layout className="w-3 h-3"/> Örnek Kat Planı Çiz
                                                                    </button>
                                                                </div>
                                                            ))}
                                                            {scenarios.length === 0 && <div className="text-xs text-red-400 text-center py-4 font-bold">Alana Sığmıyor</div>}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </section>

                                <section className="bg-white rounded-[2.5rem] p-8 shadow-sm border border-slate-200 overflow-hidden">
                                    <div className="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
                                        <div>
                                            <h2 className="text-sm font-bold text-slate-800 uppercase tracking-tight flex items-center gap-2">
                                                <Home className="w-5 h-5 text-[#1D63CB]" /> İstediğiniz oda sayılarını seçebilirsiniz.
                                            </h2>
                                            <p className="text-xs text-slate-400 font-medium mt-1">Sonuçlar en altta görünecektir..</p>
                                        </div>
                                        <div className="bg-slate-50 px-6 py-4 rounded-[1.5rem] border border-slate-100 text-right min-w-[140px] shadow-sm relative">
                                            <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Kapasite Kullanımı</div>
                                            <div className={`text-2xl font-black ${(ozet.dolulukOrani >= 100 || !ozet.yerlesimUygun) ? 'text-red-500' : 'text-[#1D63CB]'}`}>
                                                %{ozet.dolulukOrani.toFixed(1)}
                                            </div>
                                            {(ozet.dolulukOrani >= 100 || !ozet.yerlesimUygun) && (
                                                <div className="absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full animate-pulse shadow-lg" title={!ozet.yerlesimUygun ? "Zemin, normal veya çatı katı planına sığmıyor!" : "Kapasite dolu"}>
                                                    <AlertTriangle className="w-3 h-3" />
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="w-full h-5 bg-slate-100 rounded-full overflow-hidden mb-10 shadow-inner relative border border-slate-200/50">
                                        <div 
                                            className={`h-full transition-all duration-700 ease-out shadow-lg ${(ozet.dolulukOrani >= 100 || !ozet.yerlesimUygun) ? 'bg-gradient-to-r from-red-500 to-rose-600' : 'bg-gradient-to-r from-[#1D63CB] to-blue-400'}`} 
                                            style={{ width: `${Math.min(100, ozet.dolulukOrani)}%` }}
                                        ></div>
                                    </div>

                                    <div className="space-y-8">
                                        {Object.keys(DAİRE_STANDARTLARI).map((oda) => (
                                            <div key={oda} className="relative">
                                                <div className="flex items-center gap-4 mb-4">
                                                    <span className="text-lg font-black text-slate-800">{oda}</span>
                                                    <div className="h-px flex-1 bg-slate-100"></div>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-3 gap-5">
                                                    {['Kucuk', 'Orta', 'Buyuk'].map((boyut) => {
                                                        const key = `${oda}-${boyut}`;
                                                        const adet = sepet[key]?.adet || 0;
                                                        const s = DAİRE_STANDARTLARI[oda][boyut];
                                                        const testSepet = { ...sepet, [key]: { ...s, adet: adet + 1, odaTipi: oda, boyut } };
                                                        const asarMi = !checkKapasite(testSepet, ozet);

                                                        const label = boyut === 'Kucuk' ? 'KÜÇÜK' : boyut === 'Orta' ? 'ORTA' : 'BÜYÜK';
                                                        const badgeColor = boyut === 'Kucuk' ? 'bg-emerald-50 text-emerald-600 border-emerald-100' : boyut === 'Orta' ? 'bg-blue-50 text-blue-600 border-blue-100' : 'bg-orange-50 text-orange-600 border-orange-100';

                                                        return (
                                                            <div key={key} className={`bg-white p-5 rounded-[1.5rem] border transition-all duration-500 ${adet > 0 ? 'border-[#1D63CB] shadow-xl ring-4 ring-blue-50' : 'border-slate-200 hover:border-slate-300'} ${asarMi && !adet ? 'opacity-50 grayscale' : ''}`}>
                                                                <div className="flex justify-between items-center mb-1">
                                                                    <span className={`text-[10px] font-black px-2 py-1 rounded-lg border ${badgeColor}`}>{label}</span>
                                                                    <span className={`text-xs font-bold ${adet > 0 ? 'text-[#1D63CB]' : 'text-slate-300'}`}>{adet} Adet</span>
                                                                </div>
                                                                <div className="mt-3">
                                                                    <span className="text-[10px] font-bold text-slate-400 uppercase">Net Alan: {s.net}m²</span>
                                                                    <div className="text-[10px] font-medium text-slate-300">Brüt: {s.brut}m²</div>
                                                                </div>
                                                                
                                                                <div className="flex items-center justify-between mt-5 pt-4 border-t border-slate-50 print:hidden">
                                                                    <button onClick={() => updateAdet(oda, boyut, -1)} className="p-2.5 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all active:scale-95 disabled:opacity-30" disabled={adet === 0}>
                                                                        <Minus className="w-5 h-5" />
                                                                    </button>
                                                                    <span className={`text-2xl font-black ${adet > 0 ? 'text-[#1D63CB]' : 'text-slate-200'}`}>{adet}</span>
                                                                    <button onClick={() => updateAdet(oda, boyut, 1)} disabled={asarMi} className={`p-2.5 rounded-xl transition-all active:scale-95 ${asarMi ? 'text-slate-200 cursor-not-allowed' : 'text-[#1D63CB] hover:bg-blue-50'}`} title={asarMi ? "Sığmıyor" : "Ekle"}>
                                                                        <Plus className="w-5 h-5" />
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="mt-12 flex justify-between items-center pt-8 border-t border-slate-100">
                                        <button onClick={() => setSepet({})} className="flex items-center gap-2 text-xs font-bold text-slate-400 hover:text-red-500 transition-colors tracking-widest uppercase py-2 px-4 hover:bg-red-50 rounded-xl print:hidden">
                                            <Trash2 className="w-4 h-4" /> Temizle
                                        </button>
                                        <div className="text-right">
                                            <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Planlanan Toplam Ünite</div>
                                            <div className="text-4xl font-black text-slate-800">{ozet.toplamDaire} <span className="text-sm text-slate-400 font-bold uppercase">Adet</span></div>
                                        </div>
                                    </div>
                                </section>
                            </main>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
